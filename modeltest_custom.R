library(rcarbon)

Sites<-c(5061,5030,5061,5140,5113,5145,5024,5139,5092,5123,5056,5145,5030,5151,5057,5024,
5024,5166,5139,5024,5049,5061,5145,5024,5132,5030,5145,5123,5024,5024,5024,5036,5145,5007,5024,5009,
5087,5030,5124,5133,5110,5012,5123,5133,5110,5123,5124,5061,5061,5124,5124,5132,5133,5165,5163,5049,5133,
5165,5195,5195,5133,5061,5123,5165,5182,5039,5078,5166,5085,5030,5123,5123,5166,5072,5203,5024,5133,5092,5165,
5024,5133,5123,5150,5024,5002,5189,5123,5166,5195,5001,5006,5133,5165,5024,5061,5099,5107,5191,5132,5140,
5128,5185,5049,5002,5097,5024,5129,5022,5108,5024,5132,5039,5124,5131,5195,5177,5157,5202,5026,5134,5024,
5123,5131,5041,5092,5187,5049,5067,5081,5140,5182,5092,5123,5007,5024,5024,5145,5172,5165,5073,5193,5133,
5140,5170,5171,5048,5126,5043,5135,5155,5189,5033,5043,5039,5096,5165,5202,5012,5161,5191,5036,5133,5164,
5105,5203,5012,5060,5007,5050,5132,5153,5168,5202,5093,5166,5044,5176,5094,5110,5056,5012,5022,5024,5024,5036,5043,5152,5195,5134,5036,5140,5145,5146,5183,5039,5091,5007,5033,5140,5090,5094,5132,5166,5084,5190,5115,5124,5182,5039,5129,5166,5133,5146,5202,5022,5166,5183,5096,5138,5155,5039,5166,5134,5124,5166,5146,5009,5035,5120,5039,5047,5202,5098,5094,5166,5142,5062,5116,5114,5198,5202,5140,5047,5178,5005,5082,5058,5165,5140,5065,5159,5153,5183,5169,5137,5092,5016,5060,5109,5166,5147,5003,5179,5047,5157,5080,5094,5157,5087,5004,5187,5054,5112,5157,5174,5137,5166,5068,5135,5153,5054,5166,5175,5094,5111,5153,5017,5021,5058,5094,5062,5014,5172,5086,5140,5074,5185,5193,5066,5193,5153,5094,5153,5153,5113,5187,5083,5011,5193,5083,5197,5153,5052,5125,5193,5193,5135,5104,5045,5083,5054,5077,5135,5137,5153,5046,5088,5188,5147,5153,5028,5148,5160,5111,5013,5182,5194,5068,5117,5139,5106,5201,5149,5015,5193,5127,5193,5193,5160,5078,5036,5181,5053,5029,5113,5127,5014,5058,5106,5187,5188,5094,5200,5094,5193,5021,5162,5058,5083,5127,5127,5058,5060,5094,5094,5113,5113,5070,5193,5083,5193,5019,5113,5087,5193,5166,5087,5066,5054,5019,5042,5106,5127,5127,5193,5113,5113,5181,5127,5142,5160,5142,5099,5127,5113,5069,5047,5113,5005,5064,5184,5127,5113,5200,5058,5106,5130,5005,5019,5200,5053,5058,5127,5005,5058,5113,5127,5094,5074,5119,5180,5127,5106,5094,5019,5079,5186,5047,5127,5047,5127,5204,5141,5095,5127,5204,5144,5139,5077,5127,5139,5204,5083,5095,5127,5127,5071,5074,5055,5118,5005,5161,5189,5047,5004,5008,5025,5083,5127,5201,5066,5077,5047,5158,5118,5185,5189,5120,5047,5052,5023,5103,5066,5076,5005,5158,5180,5181,5185,5076,5031,5089,5126,5158,5094,5127,5201,5032,5182,5139,5127,5009,5143,5158,5018,5181,5120,5196,5127,5005,5009,5052,5077,5154,5127,5160,5009,5027,5120,5120,5102,5181,5162,5158,5185,5052,5010,5158,5051,5158,5032,5127,5009,5009,5037,5062,5156,5195,5063,5167,5059,5079,5121,5052,5120,5127,5127,5089,5121,5120,5009,5009,5097,5160,5120,5005,5143,5204,5127,5186,5158,5021,5038,5127,5009,5009,5059,5066,5120,5120,5036,5059,5034,5059,5052,5173,5121,5040,5077,5122,5077,5127,5173,5083,5059,5181,5166,5199,5158,5064,5075,5063,5127,5160,5158,5054,5127,5136,5167,5052,5097,5192,5036,5062,5093,5097,5052,5040,5020,5040,5127,5036,5181,5201,5048,5152,5106,5122,5122,5122,5136,5036,5122,5136,5062,5052,5020,5195,5127,5052)

Aar<-c(3200,3205,3215,3215,3220,3220,3235,3240,3250,3250,3263,3270,3280,3290,3300,3305,3305,3305,3310,3310,3320,3320,3320,3325,3325,3330,3330,3335,3340,3345,3355,3360,3360,3365,3365,3375,3376,3380,3380,3380,3385,3390,3390,3390,3395,3395,3400,3405,3410,3410,3410,3410,3410,3410,3415,3420,3420,3420,3420,3425,3430,3435,3435,3440,3440,3445,3445,3445,3450,3450,3455,3455,3455,3457,3460,3460,3460,3465,3465,3470,3470,3475,3480,3480,3485,3490,3495,3495,3495,3500,3500,3500,3500,3505,3505,3507,3510,3514,3515,3515,3520,3520,3520,3525,3525,3525,3526,3530,3530,3530,3530,3535,3535,3535,3535,3540,3540,3540,3543,3544,3545,3545,3545,3550,3550,3550,3550,3550,3550,3550,3550,3555,3555,3560,3560,3560,3560,3560,3565,3570,3570,3570,3570,3570,3570,3580,3580,3580,3580,3585,3590,3590,3590,3595,3595,3595,3595,3600,3600,3600,3600,3600,3603,3605,3605,3610,3610,3610,3610,3610,3610,3610,3610,3611,3615,3622,3625,3625,3625,3629,3630,3630,3635,3635,3640,3640,3640,3640,3648,3650,3650,3650,3650,3650,3660,3665,3665,3665,3665,3670,3670,3670,3675,3680,3680,3680,3680,3680,3685,3685,3685,3690,3690,3690,3695,3695,3700,3705,3710,3715,3720,3720,3733,3745,3745,3760,3765,3775,3775,3790,3790,3805,3810,3810,3810,3820,3825,3830,3830,3840,3840,3850,3860,3868,3870,3870,3870,3875,3880,3890,3895,3900,3920,3925,3940,3945,3950,3950,3950,3950,3960,3970,3970,3970,3970,3980,3980,3990,3991,3995,4000,4000,4000,4000,4000,4010,4010,4012,4015,4015,4020,4025,4030,4040,4040,4045,4046,4060,4065,4070,4075,4080,4080,4081,4085,4090,4090,4090,4095,4095,4095,4100,4100,4100,4105,4110,4110,4130,4130,4130,4130,4140,4146,4150,4150,4150,4150,4155,4160,4160,4170,4170,4170,4170,4175,4180,4180,4180,4180,4180,4182,4190,4190,4195,4200,4200,4200,4210,4210,4210,4220,4220,4229,4230,4230,4230,4240,4240,4240,4250,4250,4260,4270,4280,4280,4280,4290,4290,4300,4300,4300,4300,4300,4310,4330,4330,4335,4340,4340,4340,4340,4345,4350,4350,4350,4350,4350,4354,4355,4360,4365,4370,4375,4377,4380,4395,4398,4400,4400,4401,4405,4410,4410,4410,4420,4420,4425,4430,4430,4434,4440,4446,4450,4450,4460,4463,4470,4470,4475,4480,4485,4490,4495,4500,4505,4510,4527,4535,4536,4540,4560,4560,4560,4570,4570,4570,4580,4590,4600,4600,4610,4610,4615,4620,4622,4625,4630,4640,4640,4650,4650,4655,4660,4660,4660,4665,4669,4670,4670,4670,4680,4685,4690,4690,4690,4690,4698,4700,4702,4705,4710,4716,4720,4730,4735,4740,4755,4760,4760,4760,4770,4770,4780,4790,4796,4800,4810,4813,4820,4821,4830,4830,4840,4840,4850,4850,4850,4850,4850,4850,4855,4860,4860,4860,4860,4860,4860,4870,4870,4880,4880,4885,4885,4885,4890,4890,4891,4895,4900,4905,4905,4910,4910,4920,4920,4920,4930,4930,4931,4939,4940,4940,4945,4950,4950,4953,4955,4955,4959,4960,4960,4960,4965,4965,4965,4965,4965,4970,4990,4990,5000,5000,5005,5010,5010,5010,5010,5015,5015,5017,5020,5020,5020,5020,5021,5025,5030,5030,5030,5030,5040,5040,5040,5050,5054,5054,5055,5055,5055,5057,5060,5065,5075,5075,5080,5080,5085,5090,5090,5095,5100,5100,5100,5110,5115,5120,5125,5125,5130,5135,5142,5150,5150,5150,5155,5160,5160,5165,5180,5187,5190,5190,5190,5195,5206,5210,5238,5245,5256,5260,5270,5280,5290,5290,5300,5300,5315,5325,5325,5325,5330,5360,5400,5400,5405,5423,5425,5430,5440,5480)


Errors<-c(50,65,55,40,85,70,30,80,40,70,35,70,65,40,40,35,30,70,100,40,90,50,60,35,70,60,60,50,40,40,30,110,40,100,30,40,34,60,30,40,60,35,50,30,70,50,30,65,55,30,30,70,40,30,80,130,40,40,110,75,30,55,65,35,115,70,60,65,30,60,50,60,40,33,70,30,30,35,35,30,30,50,30,40,30,40,50,70,85,40,60,30,40,35,55,36,30,34,50,35,40,35,80,30,110,30,31,65,60,40,55,40,40,40,110,90,70,55,37,30,30,70,35,30,35,35,110,70,120,30,130,35,65,55,30,35,70,90,40,40,160,40,30,130,130,120,30,85,120,35,40,35,40,45,110,35,60,50,60,36,110,40,20,55,70,35,40,65,50,150,40,40,75,41,90,34,35,60,86,31,40,40,30,35,70,40,40,110,30,50,35,90,60,90,45,45,65,40,35,35,60,55,35,45,50,40,45,120,60,41,45,65,90,75,55,40,80,120,65,45,50,45,31,40,75,70,60,40,30,50,70,75,90,180,35,40,30,30,40,105,105,30,100,30,40,95,45,35,30,70,40,40,80,40,75,40,80,40,40,115,60,30,100,100,60,60,60,110,34,70,110,90,70,90,150,70,30,26,35,30,120,50,80,170,50,30,61,90,40,90,30,140,100,39,35,35,45,45,70,70,30,80,40,30,95,90,30,130,40,30,60,40,32,35,110,55,110,35,50,30,90,70,35,75,30,50,40,40,70,30,31,60,110,105,170,70,80,54,40,130,30,90,45,170,60,80,160,45,130,175,100,120,60,120,40,60,170,65,45,40,40,120,110,100,190,110,40,55,40,50,90,85,40,80,80,95,95,43,55,30,55,45,115,37,200,75,38,120,90,36,65,35,90,50,80,90,55,35,50,28,130,27,45,50,85,41,120,75,40,75,38,70,65,80,115,30,32,45,131,90,100,115,110,40,35,120,80,100,130,30,120,80,100,100,48,155,60,130,60,100,90,35,80,140,120,30,31,70,170,90,50,30,30,140,90,70,98,120,33,31,55,31,40,100,50,45,45,30,100,60,65,90,130,35,32,40,40,46,180,34,50,130,75,80,40,35,60,80,40,90,110,170,30,35,60,60,100,35,100,110,80,35,80,35,32,100,31,190,100,40,35,40,90,90,50,90,40,39,31,47,30,120,40,40,50,35,35,35,34,35,35,80,35,40,90,35,35,80,35,50,80,65,45,40,27,50,80,95,55,29,35,45,50,100,28,40,80,30,80,130,45,80,100,70,85,35,70,45,27,28,100,70,85,70,40,150,50,40,180,45,90,60,80,30,70,40,120,75,45,80,37,35,100,130,40,90,120,105,40,35,60,100,120,50,32,70,36,35,44,50,60,120,115,70,220,40,40,50,45,50,55,120,55,125,50,37,25,100,120,35)

caldates <- calibrate(x=Aar, errors=Errors, calCurves='intcal13', normalised=FALSE, calMatric=TRUE)

bins <- binPrep(Sites,Aar,h=200)

nsim=1000

No.spd.smoothed=spd(caldates,timeRange=c(6500,3550),bins=bins,runm=100)

logFit <- nls(PrDens~SSlogis(calBP, Asym, xmid, scale),data=No.spd.smoothed$grid,control=nls.control(maxiter=200),start=list(Asym=0.2,xmid=4500,scale=-100))

logFitDens=data.frame(calBP=No.spd.smoothed$grid$calBP,PrDens=SSlogis(input=No.spd.smoothed$grid$calBP,Asym=coefficients(logFit)
[1],xmid=coefficients(logFit)[2],scal=coefficients(logFit)[3]))

LogNull <- modelTest(caldates, errors=Errors, bins=bins, nsim=nsim, timeRange=c(6500,3000), model="custom", predgrid=logFitDens,runm=100,raw=TRUE)

plot(LogNull, xlim=c(6200,3600))
round(LogNull$pval,4)
summary(LogNull)